<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ë”±ì •í•œ ìœ„ë¡œ</title>

    <!-- OG -->
    <meta property="og:title" content="ë”±ì •í•œ ìœ„ë¡œ" />
    <meta
      property="og:description"
      content="ê´œì°®ë‹¤ê³  ë§í•´ì£¼ë˜, ê·¸ëŒ€ë¡œëŠ” ë‘ì§€ ì•ŠëŠ”. ì˜ìš• 0ì—ì„œë„ ê°€ëŠ¥í•œ 3ë¶„ í–‰ë™."
    />
    <meta
      property="og:image"
      content="https://dummyimage.com/1200x630/0b1220/ffffff&text=Strict+Comfort"
    />

    <!-- Favicon (inline SVG) -->
    <link
      rel="icon"
      href='data:image/svg+xml;utf8,
        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64">
          <rect width="64" height="64" rx="14" fill="%230b1220"/>
          <path d="M18 33c0-8 6-14 14-14s14 6 14 14" fill="none" stroke="%23ffffff" stroke-width="4" stroke-linecap="round"/>
          <circle cx="26" cy="28" r="2.4" fill="%23ffffff"/>
          <circle cx="38" cy="28" r="2.4" fill="%23ffffff"/>
          <path d="M24 44h16" stroke="%23ffffff" stroke-width="4" stroke-linecap="round"/>
        </svg>'
    />

    <style>
      :root {
        --bg: #0b1220;
        --panel: #0f1a2b;
        --panel2: #0c1524;
        --text: #eaf0ff;
        --muted: #a7b3d6;
        --muted2: #7f8ab0;
        --line: rgba(255, 255, 255, 0.09);
        --good: #c7ffd1;
        --warn: #ffe6a8;
        --bad: #ffb3b3;
        --shadow: 0 18px 40px rgba(0, 0, 0, 0.35);
        --radius: 18px;
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto,
          "Apple SD Gothic Neo", "Noto Sans KR", Arial, sans-serif;
        background: radial-gradient(
            1200px 700px at 20% 10%,
            rgba(103, 116, 255, 0.18),
            transparent 60%
          ),
          radial-gradient(
            900px 600px at 90% 30%,
            rgba(90, 255, 210, 0.1),
            transparent 55%
          ),
          var(--bg);
        color: var(--text);
        line-height: 1.55;
      }
      a {
        color: inherit;
        text-decoration: none;
      }
      .wrap {
        max-width: 980px;
        margin: 0 auto;
        padding: 22px 18px 34px;
      }
      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 10px;
        margin-bottom: 16px;
      }
      .brand {
        display: flex;
        align-items: center;
        gap: 10px;
        min-width: 0;
      }
      .logo {
        width: 40px;
        height: 40px;
        border-radius: 14px;
        background: linear-gradient(
          140deg,
          rgba(255, 255, 255, 0.14),
          rgba(255, 255, 255, 0.03)
        );
        border: 1px solid var(--line);
        display: grid;
        place-items: center;
        box-shadow: var(--shadow);
        flex: 0 0 auto;
      }
      .logo svg {
        opacity: 0.95;
      }
      .brand h1 {
        font-size: 16px;
        letter-spacing: -0.2px;
        margin: 0;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .brand p {
        margin: 0;
        font-size: 12px;
        color: var(--muted);
        letter-spacing: -0.1px;
      }
      .top-actions {
        display: flex;
        gap: 10px;
        align-items: center;
        flex: 0 0 auto;
      }
      .btn {
        appearance: none;
        border: 1px solid var(--line);
        background: rgba(255, 255, 255, 0.04);
        color: var(--text);
        padding: 10px 12px;
        border-radius: 14px;
        font-size: 13px;
        letter-spacing: -0.1px;
        cursor: pointer;
        transition: transform 0.08s ease, background 0.2s ease, border 0.2s ease;
        user-select: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }
      .btn:hover {
        background: rgba(255, 255, 255, 0.07);
        border-color: rgba(255, 255, 255, 0.15);
      }
      .btn:active {
        transform: translateY(1px);
      }
      .btn.primary {
        background: rgba(103, 116, 255, 0.2);
        border-color: rgba(103, 116, 255, 0.35);
      }
      .btn.ghost {
        background: transparent;
      }
      .grid {
        display: grid;
        grid-template-columns: 1.2fr 0.8fr;
        gap: 14px;
      }
      @media (max-width: 860px) {
        .grid {
          grid-template-columns: 1fr;
        }
      }
      .card {
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.06),
          rgba(255, 255, 255, 0.03)
        );
        border: 1px solid var(--line);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        overflow: hidden;
      }
      .card .hd {
        padding: 16px 16px 10px;
        border-bottom: 1px solid var(--line);
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.04),
          transparent
        );
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        gap: 10px;
      }
      .card .hd h2 {
        margin: 0;
        font-size: 14px;
        letter-spacing: -0.2px;
      }
      .card .hd .sub {
        margin-top: 4px;
        font-size: 12px;
        color: var(--muted);
      }
      .card .bd {
        padding: 14px 16px 16px;
      }
      .pill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid var(--line);
        background: rgba(255, 255, 255, 0.04);
        color: var(--muted);
        font-size: 12px;
        letter-spacing: -0.1px;
        white-space: nowrap;
      }
      .row {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
      }
      .stack {
        display: grid;
        gap: 10px;
      }
      .divider {
        height: 1px;
        background: var(--line);
        margin: 8px 0;
      }
      .quote {
        padding: 14px 14px;
        border-radius: 16px;
        border: 1px solid var(--line);
        background: linear-gradient(
          180deg,
          rgba(15, 26, 43, 0.85),
          rgba(12, 21, 36, 0.85)
        );
        position: relative;
        overflow: hidden;
      }
      .quote:before {
        content: "";
        position: absolute;
        inset: -1px;
        background: radial-gradient(
            600px 240px at 20% 10%,
            rgba(103, 116, 255, 0.2),
            transparent 60%
          ),
          radial-gradient(
            480px 220px at 90% 50%,
            rgba(90, 255, 210, 0.12),
            transparent 55%
          );
        opacity: 0.8;
        pointer-events: none;
      }
      .quote > * {
        position: relative;
      }
      .big {
        font-size: 18px;
        letter-spacing: -0.3px;
        margin: 0 0 8px;
        line-height: 1.35;
      }
      .small {
        margin: 0;
        color: var(--muted);
        font-size: 13px;
        letter-spacing: -0.1px;
      }
      .control {
        padding: 12px 12px;
        border-radius: 16px;
        border: 1px solid var(--line);
        background: rgba(255, 255, 255, 0.03);
      }
      label {
        display: block;
        font-size: 12px;
        color: var(--muted);
        margin-bottom: 8px;
        letter-spacing: -0.1px;
      }
      input[type="range"] {
        width: 100%;
        accent-color: #7b87ff;
      }
      .range-row {
        display: flex;
        justify-content: space-between;
        margin-top: 8px;
        color: var(--muted2);
        font-size: 12px;
      }
      .chips {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }
      .chip {
        border: 1px solid var(--line);
        background: rgba(255, 255, 255, 0.03);
        color: var(--text);
        padding: 9px 10px;
        border-radius: 999px;
        font-size: 13px;
        cursor: pointer;
        user-select: none;
        transition: background 0.2s ease, border 0.2s ease, transform 0.08s ease;
      }
      .chip:hover {
        background: rgba(255, 255, 255, 0.06);
        border-color: rgba(255, 255, 255, 0.15);
      }
      .chip:active {
        transform: translateY(1px);
      }
      .chip.selected {
        background: rgba(103, 116, 255, 0.18);
        border-color: rgba(103, 116, 255, 0.35);
      }
      .mono {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Liberation Mono", monospace;
        font-size: 12px;
        color: var(--muted);
      }
      .timer {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        padding: 12px 12px;
        border-radius: 16px;
        border: 1px solid var(--line);
        background: rgba(255, 255, 255, 0.03);
      }
      .time {
        font-size: 22px;
        letter-spacing: -0.5px;
        margin: 0;
      }
      .muted {
        color: var(--muted);
      }
      .log {
        display: grid;
        gap: 8px;
        max-height: 280px;
        overflow: auto;
        padding-right: 4px;
      }
      .log::-webkit-scrollbar {
        width: 8px;
      }
      .log::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.12);
        border-radius: 999px;
      }
      .item {
        border: 1px solid var(--line);
        background: rgba(255, 255, 255, 0.03);
        border-radius: 14px;
        padding: 10px 10px;
      }
      .item .t {
        display: flex;
        justify-content: space-between;
        gap: 10px;
        font-size: 13px;
        letter-spacing: -0.1px;
      }
      .item .d {
        margin-top: 4px;
        font-size: 12px;
        color: var(--muted);
      }
      .kbd {
        border: 1px solid var(--line);
        background: rgba(255, 255, 255, 0.04);
        padding: 2px 7px;
        border-radius: 8px;
        font-size: 12px;
        color: var(--muted);
      }
      footer {
        margin-top: 14px;
        color: var(--muted2);
        font-size: 12px;
        letter-spacing: -0.1px;
      }
      .toast {
        position: fixed;
        left: 50%;
        bottom: 18px;
        transform: translateX(-50%);
        background: rgba(12, 21, 36, 0.92);
        border: 1px solid var(--line);
        color: var(--text);
        padding: 10px 12px;
        border-radius: 14px;
        box-shadow: var(--shadow);
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.18s ease, transform 0.18s ease;
        z-index: 999;
        font-size: 13px;
        letter-spacing: -0.1px;
      }
      .toast.show {
        opacity: 1;
        transform: translateX(-50%) translateY(-2px);
      }
      .hint {
        padding: 10px 12px;
        border-radius: 16px;
        border: 1px dashed rgba(255, 255, 255, 0.14);
        background: rgba(255, 255, 255, 0.02);
        color: var(--muted);
        font-size: 12px;
      }
      /* ì„¤ë¬¸ í™”ë©´ ìŠ¤íƒ€ì¼ */
      .screen {
        display: none;
      }
      .screen.active {
        display: block;
      }
      .landing {
        text-align: center;
        padding: 80px 20px;
        max-width: 600px;
        margin: 0 auto;
        animation: fadeIn 0.5s ease;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .landing h1 {
        font-size: 36px;
        letter-spacing: -0.5px;
        margin: 0 0 20px;
        line-height: 1.3;
        background: linear-gradient(135deg, #eaf0ff 0%, #a7b3d6 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }
      .landing .subtitle {
        font-size: 20px;
        color: var(--muted);
        margin-bottom: 30px;
        line-height: 1.6;
      }
      .landing .description {
        font-size: 15px;
        color: var(--muted2);
        margin-bottom: 50px;
        line-height: 1.8;
      }
      .btn-large {
        padding: 16px 32px;
        font-size: 16px;
        border-radius: 16px;
        font-weight: 500;
        background: rgba(103, 116, 255, 0.25);
        border-color: rgba(103, 116, 255, 0.4);
      }
      .btn-large:hover {
        background: rgba(103, 116, 255, 0.35);
        border-color: rgba(103, 116, 255, 0.5);
        transform: translateY(-2px);
      }
      .survey-card {
        max-width: 700px;
        margin: 0 auto;
        animation: fadeIn 0.3s ease;
      }
      .survey-progress {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding: 0 10px;
      }
      .progress-bar {
        flex: 1;
        height: 4px;
        background: rgba(255, 255, 255, 0.08);
        border-radius: 999px;
        margin: 0 15px;
        overflow: hidden;
      }
      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, rgba(103, 116, 255, 0.6), rgba(90, 255, 210, 0.6));
        border-radius: 999px;
        transition: width 0.3s ease;
      }
      .question-number {
        font-size: 13px;
        color: var(--muted);
        white-space: nowrap;
      }
      .question-title {
        font-size: 22px;
        letter-spacing: -0.3px;
        margin: 0 0 30px;
        line-height: 1.4;
        text-align: center;
      }
      .survey-options {
        display: grid;
        gap: 12px;
        margin-bottom: 30px;
      }
      .survey-option {
        padding: 18px 20px;
        border-radius: 16px;
        border: 2px solid var(--line);
        background: rgba(255, 255, 255, 0.03);
        cursor: pointer;
        transition: all 0.2s ease;
        text-align: left;
        font-size: 15px;
        position: relative;
      }
      .survey-option:hover {
        background: rgba(255, 255, 255, 0.06);
        border-color: rgba(255, 255, 255, 0.2);
        transform: translateY(-2px);
      }
      .survey-option.selected {
        background: rgba(103, 116, 255, 0.18);
        border-color: rgba(103, 116, 255, 0.4);
        box-shadow: 0 4px 12px rgba(103, 116, 255, 0.2);
      }
      .survey-option:active {
        transform: translateY(0);
      }
      .survey-nav {
        display: flex;
        justify-content: space-between;
        gap: 12px;
        margin-top: 30px;
      }
      .result-screen {
        text-align: center;
        padding: 50px 20px;
        max-width: 700px;
        margin: 0 auto;
        animation: fadeIn 0.5s ease;
      }
      .result-emoji {
        font-size: 80px;
        margin-bottom: 24px;
        animation: bounce 0.6s ease;
      }
      @keyframes bounce {
        0%, 100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-10px);
        }
      }
      .result-title {
        font-size: 32px;
        letter-spacing: -0.4px;
        margin: 0 0 20px;
        line-height: 1.3;
        background: linear-gradient(135deg, #eaf0ff 0%, #a7b3d6 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }
      .result-description {
        font-size: 17px;
        color: var(--muted);
        line-height: 1.8;
        margin-bottom: 40px;
      }
      .result-actions {
        display: grid;
        gap: 12px;
        margin-top: 40px;
      }
      .result-action {
        padding: 16px 20px;
        border-radius: 16px;
        border: 2px solid var(--line);
        background: rgba(255, 255, 255, 0.04);
        cursor: pointer;
        transition: all 0.2s ease;
        text-align: left;
        font-size: 15px;
      }
      .result-action:hover {
        background: rgba(255, 255, 255, 0.08);
        border-color: rgba(255, 255, 255, 0.2);
      }
      .result-action.primary {
        background: rgba(103, 116, 255, 0.2);
        border-color: rgba(103, 116, 255, 0.4);
      }
    </style>
  </head>
  <body>
    <!-- ì‹œì‘ í™”ë©´ -->
    <div class="screen active" id="landingScreen">
      <div class="wrap">
        <div class="landing">
          <h1>ë”±ì •í•œ ìœ„ë¡œ</h1>
          <p class="subtitle">ì˜ìš• 0ì—ì„œë„ ê°€ëŠ¥í•œ 3ë¶„ í–‰ë™</p>
          <p class="description">
            ì§€ê¸ˆ ìƒíƒœë¥¼ "ê·¸ëŒ€ë¡œ" ì¸ì •í•˜ë˜, "ê·¸ëŒ€ë¡œ" ë‘ì§„ ì•Šê¸°<br/>
            <br/>
            ê°€ë²¼ìš´ ì„¤ë¬¸ìœ¼ë¡œ ë‚˜ì—ê²Œ ë§ëŠ” ë™ê¸°ë¶€ì—¬ ì†”ë£¨ì…˜ì„ ì°¾ì•„ë³´ì„¸ìš” âœ¨<br/>
            <span style="color: var(--muted2); font-size: 13px;">â±ï¸ ì•½ 2-3ë¶„ ì†Œìš”</span>
          </p>
          <button class="btn btn-large primary" id="btnStartSurvey">
            ì‹œì‘í•˜ê¸° ğŸš€
          </button>
        </div>
      </div>
    </div>

    <!-- ì„¤ë¬¸ í™”ë©´ -->
    <div class="screen" id="surveyScreen">
      <div class="wrap">
        <div class="survey-card card">
          <div class="bd">
            <div class="survey-progress">
              <span class="question-number" id="questionNumber">ì§ˆë¬¸ 1/5</span>
              <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 20%"></div>
              </div>
              <span class="question-number" id="questionPercent">20%</span>
            </div>
            <h2 class="question-title" id="questionTitle"></h2>
            <div class="survey-options" id="surveyOptions"></div>
            <div class="survey-nav">
              <button class="btn" id="btnPrev" style="display: none;">ì´ì „</button>
              <button class="btn primary" id="btnNext" disabled>ë‹¤ìŒ</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ê²°ê³¼ í™”ë©´ -->
    <div class="screen" id="resultScreen">
      <div class="wrap">
        <div class="result-screen">
          <div class="result-emoji" id="resultEmoji"></div>
          <h1 class="result-title" id="resultTitle"></h1>
          <p class="result-description" id="resultDescription"></p>
          <div class="result-actions" id="resultActions"></div>
        </div>
      </div>
    </div>

    <!-- ë©”ì¸ í™”ë©´ (ê¸°ì¡´) -->
    <div class="screen" id="mainScreen">
    <div class="wrap">
      <header>
        <div class="brand">
          <div class="logo" aria-hidden="true">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
              <path
                d="M7 13c0-3 2.5-5.5 5.5-5.5S18 10 18 13"
                stroke="white"
                stroke-width="2"
                stroke-linecap="round"
              />
              <path
                d="M9 17h6"
                stroke="white"
                stroke-width="2"
                stroke-linecap="round"
              />
              <circle cx="10" cy="11" r="1" fill="white" />
              <circle cx="14" cy="11" r="1" fill="white" />
            </svg>
          </div>
          <div style="min-width: 0">
            <h1>ë”±ì •í•œ ìœ„ë¡œ</h1>
            <p>ì˜ìš• 0ì—ì„œë„ ê°€ëŠ¥í•œ 3ë¶„ í–‰ë™ â€” ë‹¤ë…ì´ë˜, ê·¸ëŒ€ë¡œëŠ” ë‘ì§€ ì•Šê¸°</p>
          </div>
        </div>

        <div class="top-actions">
          <button class="btn ghost" id="btnRestartSurvey">ì„¤ë¬¸ ë‹¤ì‹œí•˜ê¸°</button>
          <a
            class="btn ghost"
            href="https://funnyfunny.cloud"
            target="_blank"
            rel="noopener"
          >
            ë‹¤ë¥¸ ì„œë¹„ìŠ¤ ë³´ê¸°
          </a>
          <button class="btn" id="btnExport">ê¸°ë¡ ë³µì‚¬</button>
          <button class="btn primary" id="btnReset">ì´ˆê¸°í™”</button>
        </div>
      </header>

      <div class="grid">
        <!-- LEFT: main flow -->
        <section class="card">
          <div class="hd">
            <div>
              <h2>ì§€ê¸ˆ ìƒíƒœë¥¼ â€œê·¸ëŒ€ë¡œâ€ ì¸ì •í•˜ë˜, â€œê·¸ëŒ€ë¡œâ€ ë‘ì§„ ì•Šê¸°</h2>
              <div class="sub">ê³µê° â†’ í˜„ì‹¤ í•œ ë¬¸ì¥ â†’ ì„ íƒê¶Œ â†’ ìµœì†Œ í–‰ë™</div>
            </div>
            <div class="row">
              <span class="pill" id="modePill">ëª¨ë“œ: ìë™</span>
              <span class="pill" id="todayPill">ì˜¤ëŠ˜: -</span>
            </div>
          </div>

          <div class="bd stack">
            <div class="quote" aria-live="polite">
              <p class="big" id="mainLine">
                ì˜¤ëŠ˜ ì˜ìš•ì´ ì—†ì§€? ì´ìƒí•œ ê²Œ ì•„ë‹ˆì•¼.
              </p>
              <p class="small" id="subLine">
                ë‹¤ë§Œ, ì§€ê¸ˆ â€œì•„ë¬´ê²ƒë„ ì•ˆ í•˜ë©´â€ ì´ ìƒíƒœëŠ” ì¢‹ì•„ì§€ì§€ ì•Šì•„.
              </p>
            </div>

            <div class="control">
              <label for="energy">í˜„ì¬ ì˜ìš•/ì—ë„ˆì§€ (0~10)</label>
              <input id="energy" type="range" min="0" max="10" value="3" />
              <div class="range-row">
                <span>0 (ë°”ë‹¥)</span>
                <span class="mono">í˜„ì¬: <span id="energyVal">3</span></span>
                <span>10 (ì¶©ë§Œ)</span>
              </div>
            </div>

            <div class="control">
              <label>ì˜¤ëŠ˜ì˜ â€œë§‰í˜â€ì€ ë­ì— ê°€ê¹Œì›Œ?</label>
              <div class="chips" id="blockers">
                <div class="chip" data-key="tired">í”¼ê³¤í•¨/ìˆ˜ë©´ë¶€ì¡±</div>
                <div class="chip" data-key="anxious">ë¶ˆì•ˆ/ê±±ì •</div>
                <div class="chip" data-key="overwhelmed">í•  ì¼ ê³¼ë‹¤</div>
                <div class="chip" data-key="avoid">íšŒí”¼/ë¯¸ë£¨ê¸°</div>
                <div class="chip" data-key="empty">ë¬´ê°ê°/ê³µí—ˆ</div>
                <div class="chip" data-key="pain">ëª¸í†µì¦/ì»¨ë””ì…˜</div>
              </div>
              <div class="divider"></div>
              <div class="hint">
                íŒ: ì´ ì„œë¹„ìŠ¤ëŠ” â€œê¸°ë¶„ì„ ì¢‹ê²Œ ë§Œë“œëŠ” ê²ƒâ€ë³´ë‹¤,
                <b>ì§€ê¸ˆ ìƒíƒœì—ì„œë„ ê°€ëŠ¥í•œ ìµœì†Œ ì›€ì§ì„</b>ì— ì§‘ì¤‘í•´. ì˜ìš•ì´
                ìƒê¸°ë©´ í•˜ëŠ” ê²Œ ì•„ë‹ˆë¼,
                <b>ì¡°ê¸ˆ ì›€ì§ì—¬ì„œ ì˜ìš•ì„ ë”°ë¼ì˜¤ê²Œ</b> ë§Œë“œëŠ” ë°©ì‹ì´ì•¼.
              </div>
            </div>

            <div class="control">
              <label>ì˜¤ëŠ˜ â€œë”± í•˜ë‚˜â€ ê³ ë¥´ê¸° (ì˜ìš• í•„ìš” ì—†ëŠ” ë‹¨ìœ„)</label>
              <div class="chips" id="actions">
                <div class="chip" data-action="water">ë¬¼ í•œ ì»µ ë§ˆì‹œê¸°</div>
                <div class="chip" data-action="sit">ì¹¨ëŒ€ì—ì„œ ì¼ì–´ë‚˜ ì•‰ê¸°</div>
                <div class="chip" data-action="title">
                  í•  ì¼ ëª©ë¡ â€˜ì œëª©ë§Œâ€™ ì ê¸°
                </div>
                <div class="chip" data-action="delete">
                  ì•ˆ í•´ë„ ë˜ëŠ” ê²ƒ 1ê°œ ì§€ìš°ê¸°
                </div>
                <div class="chip" data-action="shower">ì„¸ìˆ˜/ìƒ¤ì›Œ â€˜ì‹œì‘â€™ë§Œ</div>
                <div class="chip" data-action="desk">ì±…ìƒ ìœ„ 3ê°œë§Œ ì •ë¦¬</div>
                <div class="chip" data-action="out">í˜„ê´€ ë°– 30ì´ˆ ì„œê¸°</div>
                <div class="chip" data-action="call">ë©”ì‹œì§€ 1ê°œë§Œ ë³´ë‚´ê¸°</div>
              </div>
              <div class="divider"></div>
              <div class="row">
                <button class="btn primary" id="btnGenerate">
                  ë©˜íŠ¸ ë§Œë“¤ê¸°
                </button>
                <button class="btn" id="btnStart3">3ë¶„ íƒ€ì´ë¨¸</button>
                <button class="btn" id="btnDone">í–ˆë‹¤(ì²´í¬)</button>
                <button class="btn" id="btnSkip">ì˜¤ëŠ˜ì€ í¬ê¸° ì„ ì–¸</button>
              </div>
            </div>

            <div class="timer" role="region" aria-label="3ë¶„ íƒ€ì´ë¨¸">
              <div>
                <p class="time" id="time">03:00</p>
                <div class="muted" id="timerHint">
                  ë²„íŠ¼ ëˆ„ë¥´ë©´ ë°”ë¡œ ì‹œì‘. ë©ˆì¶°ë„ ë¨. ì¤‘ìš”í•œ ê±´ â€œì‹œì‘â€ ê¸°ë¡.
                </div>
              </div>
              <div class="row">
                <button class="btn" id="btnPause">ì¼ì‹œì •ì§€</button>
                <button class="btn" id="btnStop">ì¢…ë£Œ</button>
              </div>
            </div>

            <div class="control">
              <label>ë©”ëª¨ (ì„ íƒ)</label>
              <input
                id="memo"
                type="text"
                placeholder="ì˜ˆ: 3ë¶„ë§Œ í–ˆëŠ”ë°ë„ ì¢€ ëœ ë¬´ê±°ì›€ / ê·¸ëƒ¥ ì‹œì‘ì´ ì–´ë ¤ì› ìŒ"
                style="
                  width: 100%;
                  padding: 12px 12px;
                  border-radius: 14px;
                  border: 1px solid var(--line);
                  background: rgba(255, 255, 255, 0.03);
                  color: var(--text);
                "
              />
              <div class="range-row">
                <span>ê¸°ë¡ì€ í‰ê°€ê°€ ì•„ë‹ˆë¼ â€œì¦ê±°â€ì•¼</span>
                <span class="mono"><span class="kbd">Enter</span>ë¡œ ì €ì¥</span>
              </div>
            </div>
          </div>
        </section>

        <!-- RIGHT: logs + guidance -->
        <aside class="card">
          <div class="hd">
            <div>
              <h2>ì˜¤ëŠ˜ ê¸°ë¡</h2>
              <div class="sub">
                ì˜í–ˆëŠ”ì§€ ëª»í–ˆëŠ”ì§€ íŒë‹¨ ê¸ˆì§€. â€œí–ˆë‹¤/ì‹œì‘í–ˆë‹¤â€ë§Œ ë‚¨ê¸°ê¸°.
              </div>
            </div>
            <span class="pill" id="streakPill">ì—°ì†: 0ì¼</span>
          </div>
          <div class="bd stack">
            <div class="control">
              <label>ëƒ‰ì •í•œ ì›ì¹™ (ì„œë¹„ìŠ¤ ë¼ˆëŒ€)</label>
              <div class="hint" id="principles">
                1) ì˜ìš•ì€ ì „ì œ ì¡°ê±´ì´ ì•„ë‹˜<br />
                2) ê°ì •ì€ ì‚¬ì‹¤ë¡œ ì¡´ì¤‘, í–‰ë™ì€ ì„ íƒìœ¼ë¡œ ê²°ì •<br />
                3) â€œí° ê²°ì‹¬â€ ê¸ˆì§€, â€œì‘ì€ ì‹œì‘â€ë§Œ í—ˆìš©<br />
                4) ì‰¬ëŠ” ê±´ íšŒë³µ, ë©ˆì¶¤ì€ ì •ì²´ â€” êµ¬ë¶„í•˜ê¸°
              </div>
            </div>

            <div class="control">
              <label>ë¡œê·¸</label>
              <div class="log" id="log"></div>
              <div class="divider"></div>
              <div class="row">
                <button class="btn" id="btnClearLog">ì˜¤ëŠ˜ ê¸°ë¡ ì§€ìš°ê¸°</button>
                <button class="btn" id="btnNudge">ë‹¤ìŒ í•œ ë¬¸ì¥</button>
              </div>
            </div>

            <div class="control">
              <label>ì•ˆì „ ê°€ì´ë“œ</label>
              <div class="hint">
                ì´ ì„œë¹„ìŠ¤ëŠ” â€œìƒí™œ/ìƒì‚°ì„± ì½”ì¹­â€ ì„±ê²©ì´ì•¼. ë§Œì•½ ë¬´ê¸°ë ¥ì´ ì˜¤ë˜
                ì§€ì†ë˜ê±°ë‚˜(ì˜ˆ: ìˆ˜ì£¼ ì´ìƒ), ìˆ˜ë©´/ì‹ì‚¬/ì¼ìƒ ê¸°ëŠ¥ì´ í¬ê²Œ ë¬´ë„ˆì§„
                ìƒíƒœë¼ë©´, ì „ë¬¸ê°€ ë„ì›€(ìƒë‹´/ì§„ë£Œ)ì„ ë³‘í–‰í•˜ëŠ” ê²Œ ë” ë¹ ë¥¼ ìˆ˜ ìˆì–´.
                <br /><br />
                ë‹¨, ì˜¤ëŠ˜ì€ ê²°ë¡  í•˜ë‚˜: <b>0ì—ì„œ 1ë§Œ ë§Œë“¤ì.</b>
              </div>
            </div>
          </div>
        </aside>
      </div>

      <footer>
        â“˜ ì €ì¥ì€ ì´ ë¸Œë¼ìš°ì €(ë¡œì»¬) ì•ˆì—ì„œë§Œ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤. (localStorage) Â·
        ë‹¨ì¶•í‚¤: <span class="kbd">G</span> ë©˜íŠ¸ Â·
        <span class="kbd">T</span> íƒ€ì´ë¨¸ Â· <span class="kbd">D</span> í–ˆë‹¤ Â·
        <span class="kbd">N</span> ë‹¤ìŒ í•œ ë¬¸ì¥
      </footer>
    </div>

    <div class="toast" id="toast"></div>

    <script>
      // =========================
      // State & helpers
      // =========================
      const $ = (s) => document.querySelector(s);
      const $$ = (s) => Array.from(document.querySelectorAll(s));

      const LS_KEY = "strict_comfort_v1";
      const todayKey = () => new Date().toISOString().slice(0, 10);

      // ì„¤ë¬¸ ì§ˆë¬¸ë“¤
      const SURVEY_QUESTIONS = [
        {
          question: "ì§€ê¸ˆ ê¸°ë¶„ì´ ì–´ë•Œ?",
          options: [
            { text: "ì™„ì „íˆ ë¬´ê¸°ë ¥í•´ ğŸ˜´", value: "empty", energy: 1 },
            { text: "í”¼ê³¤í•˜ê³  ì§€ì³ ğŸ’¤", value: "tired", energy: 2 },
            { text: "ë¶ˆì•ˆí•˜ê³  ê±±ì •ë¼ ğŸ˜°", value: "anxious", energy: 3 },
            { text: "í•  ì¼ì´ ë„ˆë¬´ ë§ì•„ ğŸ“‹", value: "overwhelmed", energy: 4 },
            { text: "ê·¸ëƒ¥ ë¯¸ë£¨ê³  ì‹¶ì–´ ğŸ« ", value: "avoid", energy: 3 },
            { text: "ê´œì°®ì•„, ê·¸ëƒ¥ ì‹œì‘ì´ ì–´ë ¤ì›Œ ğŸ¤·", value: "ok", energy: 5 },
          ]
        },
        {
          question: "ì§€ê¸ˆ ì—ë„ˆì§€ ë ˆë²¨ì€?",
          options: [
            { text: "0 - ì™„ì „íˆ ë°”ë‹¥ ğŸ”‹", value: 0 },
            { text: "1-2 - ê±°ì˜ ì—†ìŒ ğŸ”‹", value: 1 },
            { text: "3-4 - ì¡°ê¸ˆ ìˆìŒ ğŸ”‹", value: 3 },
            { text: "5-6 - ë³´í†µ ğŸ”‹", value: 5 },
            { text: "7-8 - ê´œì°®ìŒ ğŸ”‹", value: 7 },
            { text: "9-10 - ì¶©ë§Œí•¨ ğŸ”‹", value: 9 },
          ]
        },
        {
          question: "ì§€ê¸ˆ ê°€ì¥ ë§‰íˆëŠ” ê±´ ë­ì•¼?",
          options: [
            { text: "ì‹œì‘ ìì²´ê°€ ì–´ë ¤ì›Œ ğŸšª", value: "start" },
            { text: "í•  ì¼ì´ ë„ˆë¬´ ë§ì•„ì„œ ì••ë„ë¼ ğŸ“š", value: "overwhelmed" },
            { text: "ì™„ë²½í•˜ê²Œ í•´ì•¼ í•œë‹¤ëŠ” ì••ë°• âš¡", value: "perfection" },
            { text: "ì˜ìš•ì´ ì „í˜€ ì—†ì–´ ğŸ’­", value: "motivation" },
            { text: "ë­˜ í•´ì•¼ í• ì§€ ëª¨ë¥´ê² ì–´ â“", value: "direction" },
            { text: "ê·¸ëƒ¥ í”¼í•˜ê³  ì‹¶ì–´ ğŸƒ", value: "avoid" },
          ]
        },
        {
          question: "ì§€ê¸ˆ í•  ìˆ˜ ìˆëŠ” ê°€ì¥ ì‘ì€ í–‰ë™ì€?",
          options: [
            { text: "ğŸ’§ ë¬¼ í•œ ì»µ ë§ˆì‹œê¸°", value: "water" },
            { text: "ğŸª‘ ì¹¨ëŒ€ì—ì„œ ì¼ì–´ë‚˜ ì•‰ê¸°", value: "sit" },
            { text: "ğŸ“ í•  ì¼ ëª©ë¡ ì œëª©ë§Œ ì ê¸°", value: "title" },
            { text: "ğŸ—‘ï¸ ì•ˆ í•´ë„ ë˜ëŠ” ê²ƒ 1ê°œ ì§€ìš°ê¸°", value: "delete" },
            { text: "ğŸš¿ ì„¸ìˆ˜/ìƒ¤ì›Œ ì‹œì‘ë§Œ", value: "shower" },
            { text: "ğŸ“¦ ì±…ìƒ ìœ„ 3ê°œë§Œ ì •ë¦¬", value: "desk" },
            { text: "ğŸŒ¬ï¸ í˜„ê´€ ë°– 30ì´ˆ ì„œê¸°", value: "out" },
            { text: "ğŸ’¬ ë©”ì‹œì§€ 1ê°œë§Œ ë³´ë‚´ê¸°", value: "call" },
          ]
        },
        {
          question: "ì˜¤ëŠ˜ ëª©í‘œëŠ”?",
          options: [
            { text: "ê·¸ëƒ¥ ì‹œì‘ë§Œ í•˜ë©´ ë¼ âœ¨", value: "start" },
            { text: "3ë¶„ë§Œ í•˜ë©´ ë¼ â±ï¸", value: "3min" },
            { text: "í•˜ë‚˜ë§Œ ì™„ë£Œí•˜ë©´ ë¼ âœ…", value: "one" },
            { text: "ê¸°ë¡ë§Œ ë‚¨ê¸°ë©´ ë¼ ğŸ“", value: "record" },
          ]
        }
      ];

      // ê²°ê³¼ íƒ€ì…ë³„ ë©”ì‹œì§€
      const RESULT_TYPES = {
        empty: {
          emoji: "ğŸŒ±",
          title: "ìƒˆì‹¹ íƒ€ì…",
          description: "ì™„ì „íˆ ë¬´ê¸°ë ¥í•œ ì§€ê¸ˆë„ ê´œì°®ì•„. ì´ìƒí•œ ê²Œ ì•„ë‹ˆì•¼! ğŸŒ± í•˜ì§€ë§Œ ì‘ì€ ì›€ì§ì„ í•˜ë‚˜ë¡œ ì‹œì‘í•  ìˆ˜ ìˆì–´. ì§€ê¸ˆ ë°”ë¡œ í•´ë³¼ê¹Œ?",
          actions: [
            { text: "ğŸ’§ ë¬¼ í•œ ì»µ ë§ˆì‹œê¸°", action: "water", message: "ì¢‹ì•„! ê°€ì¥ ì‘ì€ ì›€ì§ì„ë¶€í„° ì‹œì‘í–ˆì–´. ì´ì œ ì¡°ê¸ˆ ë” ê°€ë³ì§€ ì•Šì•„?" },
            { text: "ğŸª‘ ì¹¨ëŒ€ì—ì„œ ì¼ì–´ë‚˜ ì•‰ê¸°", action: "sit", message: "ì™„ë²½í•´! ì¼ì–´ë‚˜ ì•‰ëŠ” ê²ƒë§Œìœ¼ë¡œë„ ì¶©ë¶„í•œ ì‹œì‘ì´ì•¼. ì˜í•˜ê³  ìˆì–´!" },
          ]
        },
        tired: {
          emoji: "ğŸ’¤",
          title: "íšŒë³µ íƒ€ì…",
          description: "í”¼ê³¤í•˜ê³  ì§€ì¹œ ì§€ê¸ˆë„ ì´í•´í•´. í•˜ì§€ë§Œ ê°€ì¥ ê°€ë²¼ìš´ ì›€ì§ì„ë¶€í„° ì‹œì‘í•´ë³´ì. ë¬´ë¦¬í•˜ì§€ ë§ê³ , ë”± í•˜ë‚˜ë§Œ! ğŸ’ª",
          actions: [
            { text: "ğŸŒ¬ï¸ í˜„ê´€ ë°– 30ì´ˆ ì„œê¸°", action: "out", message: "ë°”ê¹¥ ê³µê¸°ë§Œ ë§ˆì…”ë„ ëª¸ì´ ê¹¨ì–´ë‚  ìˆ˜ ìˆì–´. ì˜í–ˆì–´!" },
            { text: "ğŸš¿ ì„¸ìˆ˜ ì‹œì‘ë§Œ", action: "shower", message: "ë¬¼ì— ì†ë§Œ ëŒ€ë„ ê¸°ë¶„ì´ ì „í™˜ë  ìˆ˜ ìˆì–´. ì‹œì‘ì´ ì¤‘ìš”í•´!" },
          ]
        },
        anxious: {
          emoji: "ğŸ«‚",
          title: "ì•ˆì • íƒ€ì…",
          description: "ë¶ˆì•ˆí•˜ê³  ê±±ì •ë˜ëŠ” ë§ˆìŒ, ì¸ì •í•´. í•˜ì§€ë§Œ ì‘ì€ í–‰ë™ í•˜ë‚˜ê°€ ê·¸ ê°ì •ì„ ì¡°ê¸ˆì”© í’€ì–´ì¤„ ê±°ì•¼. í•¨ê»˜ í•´ë³¼ê¹Œ? ğŸ¤",
          actions: [
            { text: "ğŸ“ í•  ì¼ ëª©ë¡ ì œëª©ë§Œ ì ê¸°", action: "title", message: "ë¨¸ë¦¿ì† ê±±ì •ì„ ì¢…ì´ì— ì˜®ê¸°ë©´ ì¡°ê¸ˆ ê°€ë²¼ì›Œì ¸. ì˜í•˜ê³  ìˆì–´!" },
            { text: "ğŸ—‘ï¸ ì•ˆ í•´ë„ ë˜ëŠ” ê²ƒ 1ê°œ ì§€ìš°ê¸°", action: "delete", message: "ë¶€ë‹´ì„ ì¤„ì´ëŠ” ê²ƒë„ ì¤‘ìš”í•œ í–‰ë™ì´ì•¼. ë©‹ì ¸!" },
          ]
        },
        overwhelmed: {
          emoji: "ğŸ“‹",
          title: "ì •ë¦¬ íƒ€ì…",
          description: "í•  ì¼ì´ ë§ì•„ì„œ ì••ë„ë˜ëŠ” ëŠë‚Œì´ì§€? ê·¸ëŸ´ìˆ˜ë¡ ì‘ê²Œ ë‚˜ëˆ„ê³ , í•˜ë‚˜ì”©ë§Œ ì‹œì‘í•˜ì. ì™„ë²½í•˜ì§€ ì•Šì•„ë„ ë¼! âœ¨",
          actions: [
            { text: "ğŸ—‘ï¸ ì•ˆ í•´ë„ ë˜ëŠ” ê²ƒ 1ê°œ ì§€ìš°ê¸°", action: "delete", message: "í•  ì¼ì„ ì¤„ì´ëŠ” ê²ƒë„ ì¤‘ìš”í•œ í–‰ë™ì´ì•¼. ì˜í–ˆì–´!" },
            { text: "ğŸ“¦ ì±…ìƒ ìœ„ 3ê°œë§Œ ì •ë¦¬", action: "desk", message: "ì‘ì€ ê³µê°„ë¶€í„° ì •ë¦¬í•˜ë©´ ë§ˆìŒë„ ì •ë¦¬ë¼. ë©‹ì ¸!" },
          ]
        },
        avoid: {
          emoji: "ğŸ¯",
          title: "ì‹œì‘ íƒ€ì…",
          description: "ë¯¸ë£¨ê³  ì‹¶ì€ ë§ˆìŒë„ ì´í•´í•´. í•˜ì§€ë§Œ ë”± 3ë¶„ë§Œ í•˜ë©´ ë¼. ê·¸ ì´ìƒì€ ìš•ì‹¬ì´ì•¼. ì§€ê¸ˆ ë°”ë¡œ ì‹œì‘í•´ë³¼ê¹Œ? ğŸš€",
          actions: [
            { text: "ğŸ’¬ ë©”ì‹œì§€ 1ê°œë§Œ ë³´ë‚´ê¸°", action: "call", message: "ê°€ì¥ ì‘ì€ ì†Œí†µë¶€í„° ì‹œì‘í–ˆì–´. ì˜í•˜ê³  ìˆì–´!" },
            { text: "ğŸ“ í•  ì¼ ëª©ë¡ ì œëª©ë§Œ ì ê¸°", action: "title", message: "ì™„ë²½í•˜ê²Œ ì ì„ í•„ìš” ì—†ì–´. ì œëª©ë§Œ ì ìœ¼ë©´ ë¼. ë©‹ì ¸!" },
          ]
        },
        ok: {
          emoji: "âœ¨",
          title: "ì¤€ë¹„ íƒ€ì…",
          description: "ê´œì°®ì€ ìƒíƒœì—ì„œ ì‹œì‘ì´ ì–´ë ¤ìš´ ê±°ë¼ë©´, ì´ì œ ë°”ë¡œ ì‹œì‘í•  ìˆ˜ ìˆì–´! ì§€ê¸ˆì´ ë°”ë¡œ ì‹œì‘í•  ë•Œì•¼! ğŸ’«",
          actions: [
            { text: "â±ï¸ 3ë¶„ íƒ€ì´ë¨¸ ì‹œì‘", action: "timer", message: "ì§€ê¸ˆ ë°”ë¡œ 3ë¶„ë§Œ í•´ë³´ì. ëë‚˜ë©´ ê·¸ë§Œí•´ë„ ë¼. ì‹œì‘ì´ ì¤‘ìš”í•´!" },
            { text: "ğŸ¯ ê°€ì¥ ì‘ì€ í–‰ë™ë¶€í„°", action: "any", message: "ì–´ë–¤ ì‘ì€ í–‰ë™ì´ë“  ì¢‹ì•„. ì‹œì‘ë§Œ í•˜ë©´ ë¼. ì˜í•˜ê³  ìˆì–´!" },
          ]
        }
      };

      const state = {
        currentScreen: "landing",
        surveyAnswers: [],
        currentQuestionIndex: 0,
        energy: 3,
        blockers: new Set(),
        action: null,
        memo: "",
        logsByDay: {}, // { "YYYY-MM-DD": [ {ts, type, action, energy, blockers, memo} ] }
        streak: 0,
        lastDayDone: null,
        timer: {
          running: false,
          remaining: 180,
          interval: null,
          startedAt: null,
        },
      };

      const ACTION_LABELS = {
        water: "ë¬¼ í•œ ì»µ ë§ˆì‹œê¸°",
        sit: "ì¹¨ëŒ€ì—ì„œ ì¼ì–´ë‚˜ ì•‰ê¸°",
        title: "í•  ì¼ ëª©ë¡ â€˜ì œëª©ë§Œâ€™ ì ê¸°",
        delete: "ì•ˆ í•´ë„ ë˜ëŠ” ê²ƒ 1ê°œ ì§€ìš°ê¸°",
        shower: "ì„¸ìˆ˜/ìƒ¤ì›Œ â€˜ì‹œì‘â€™ë§Œ",
        desk: "ì±…ìƒ ìœ„ 3ê°œë§Œ ì •ë¦¬",
        out: "í˜„ê´€ ë°– 30ì´ˆ ì„œê¸°",
        call: "ë©”ì‹œì§€ 1ê°œë§Œ ë³´ë‚´ê¸°",
      };

      const BLOCKER_LABELS = {
        tired: "í”¼ê³¤í•¨/ìˆ˜ë©´ë¶€ì¡±",
        anxious: "ë¶ˆì•ˆ/ê±±ì •",
        overwhelmed: "í•  ì¼ ê³¼ë‹¤",
        avoid: "íšŒí”¼/ë¯¸ë£¨ê¸°",
        empty: "ë¬´ê°ê°/ê³µí—ˆ",
        pain: "ëª¸í†µì¦/ì»¨ë””ì…˜",
      };

      function showToast(msg) {
        const t = $("#toast");
        t.textContent = msg;
        t.classList.add("show");
        setTimeout(() => t.classList.remove("show"), 1400);
      }

      function save() {
        const payload = {
          energy: state.energy,
          blockers: Array.from(state.blockers),
          action: state.action,
          memo: state.memo,
          logsByDay: state.logsByDay,
          streak: state.streak,
          lastDayDone: state.lastDayDone,
        };
        localStorage.setItem(LS_KEY, JSON.stringify(payload));
      }

      function load() {
        const raw = localStorage.getItem(LS_KEY);
        if (!raw) return;
        try {
          const p = JSON.parse(raw);
          state.energy = Number.isFinite(p.energy) ? p.energy : 3;
          state.blockers = new Set(Array.isArray(p.blockers) ? p.blockers : []);
          state.action = p.action || null;
          state.memo = p.memo || "";
          state.logsByDay = p.logsByDay || {};
          state.streak = p.streak || 0;
          state.lastDayDone = p.lastDayDone || null;
        } catch (e) {}
      }

      function fmtTime(sec) {
        const m = String(Math.floor(sec / 60)).padStart(2, "0");
        const s = String(sec % 60).padStart(2, "0");
        return `${m}:${s}`;
      }

      function nowTime() {
        const d = new Date();
        const hh = String(d.getHours()).padStart(2, "0");
        const mm = String(d.getMinutes()).padStart(2, "0");
        return `${hh}:${mm}`;
      }

      function logEntry(type) {
        const day = todayKey();
        if (!state.logsByDay[day]) state.logsByDay[day] = [];

        const entry = {
          ts: new Date().toISOString(),
          time: nowTime(),
          type, // "generate" | "timer_start" | "timer_done" | "done" | "skip" | "memo"
          action: state.action,
          energy: state.energy,
          blockers: Array.from(state.blockers),
          memo: state.memo?.trim() || "",
        };

        state.logsByDay[day].unshift(entry);
        save();
        renderLog();
        updateStreakIfNeeded(type);
      }

      function updateStreakIfNeeded(type) {
        // streak: when user marks "done" or finishes timer, count day as done.
        if (type !== "done" && type !== "timer_done") return;

        const day = todayKey();
        if (state.lastDayDone === day) return;

        // compute streak by checking consecutive days with "done" or "timer_done"
        state.lastDayDone = day;

        // rebuild streak from today backwards
        let streak = 0;
        let d = new Date(day + "T00:00:00");
        for (;;) {
          const key = d.toISOString().slice(0, 10);
          const arr = state.logsByDay[key] || [];
          const hasDone = arr.some(
            (x) => x.type === "done" || x.type === "timer_done"
          );
          if (!hasDone) break;
          streak += 1;
          d.setDate(d.getDate() - 1);
        }
        state.streak = streak;
        save();
        renderStreak();
      }

      // =========================
      // Copy/export
      // =========================
      async function copyText(text) {
        try {
          await navigator.clipboard.writeText(text);
          showToast("ê¸°ë¡ì„ ë³µì‚¬í–ˆì–´");
        } catch (e) {
          // fallback
          const ta = document.createElement("textarea");
          ta.value = text;
          document.body.appendChild(ta);
          ta.select();
          document.execCommand("copy");
          ta.remove();
          showToast("ê¸°ë¡ì„ ë³µì‚¬í–ˆì–´");
        }
      }

      function exportToday() {
        const day = todayKey();
        const arr = state.logsByDay[day] || [];
        const action = state.action ? ACTION_LABELS[state.action] : "ë¯¸ì„ íƒ";
        const blockers =
          Array.from(state.blockers)
            .map((k) => BLOCKER_LABELS[k])
            .join(", ") || "ë¯¸ì„ íƒ";

        const lines = [];
        lines.push(`[ë”±ì •í•œ ìœ„ë¡œ] ${day}`);
        lines.push(`- ì—ë„ˆì§€: ${state.energy}/10`);
        lines.push(`- ë§‰í˜: ${blockers}`);
        lines.push(`- ì˜¤ëŠ˜ì˜ í•˜ë‚˜: ${action}`);
        if (state.memo?.trim()) lines.push(`- ë©”ëª¨: ${state.memo.trim()}`);
        lines.push(`- ë¡œê·¸(${arr.length}):`);
        for (const x of arr.slice().reverse()) {
          const t = x.time || "";
          const tag =
            {
              generate: "ë©˜íŠ¸",
              timer_start: "íƒ€ì´ë¨¸ ì‹œì‘",
              timer_done: "íƒ€ì´ë¨¸ ì™„ë£Œ",
              done: "í–ˆë‹¤(ì²´í¬)",
              skip: "í¬ê¸° ì„ ì–¸",
              memo: "ë©”ëª¨ ì €ì¥",
            }[x.type] || x.type;
          const act = x.action ? ACTION_LABELS[x.action] : "â€”";
          lines.push(`  â€¢ ${t} / ${tag} / ${act}`);
        }
        return lines.join("\n");
      }

      // =========================
      // Script engine: comfort + cold reality + choice + minimum move
      // =========================
      function modeByEnergy(e) {
        // auto: lower energy -> warmer + shorter + non-pushy
        // higher energy -> firmer + clearer
        if (e <= 2) return "ë¶€ë“œëŸ½ê²Œ";
        if (e <= 5) return "ê· í˜•";
        return "ëƒ‰ì •";
      }

      function pick(arr) {
        return arr[Math.floor(Math.random() * arr.length)];
      }

      function buildLines() {
        const e = state.energy;
        const mode = modeByEnergy(e);
        const action = state.action ? ACTION_LABELS[state.action] : null;
        const blockers = Array.from(state.blockers);

        // 1) validate (ê³µê°)
        const validateSoft = [
          "ì˜¤ëŠ˜ ì˜ìš•ì´ ì—†ì§€? ì´ìƒí•œ ê²Œ ì•„ë‹ˆì•¼.",
          "ì§€ê¸ˆ ë¬´ê¸°ë ¥í•œ ê±´ â€˜ê²Œìœ¼ë¦„â€™ì´ ì•„ë‹ˆë¼, ì‹ í˜¸ì¼ ë•Œê°€ ë§ì•„.",
          "ì§€ê¸ˆ ìƒíƒœì—ì„œ ë²„í‹°ëŠ” ê²ƒ ìì²´ê°€ ì´ë¯¸ ì‰½ì§€ ì•Šì•„.",
        ];
        const validateBalanced = [
          "ì˜ìš•ì´ ë°”ë‹¥ì´ë©´, ê·¸ê±´ ê·¸ëƒ¥ í˜„ì¬ ìƒíƒœì•¼. ì£„ê°€ ì•„ë‹ˆì•¼.",
          "ì§€ê¸ˆ í˜ë“  ê±´ ì¸ì •í• ê²Œ. ê·¸ëŸ°ë° ê·¸ê²Œ ê²°ë¡ ì€ ì•„ë‹ˆì•¼.",
          "ë¬´ê¸°ë ¥ì€ í”í•´. ë‹¤ë§Œ ë°©ì¹˜í•˜ë©´ ìŠµê´€ì´ ë¼.",
        ];
        const validateCold = [
          "ì˜ìš•ì´ ì—†ë‹¤ëŠ” ì‚¬ì‹¤ì€ ì¸ì •. ê·¸ëŸ°ë° ê·¸ê±¸ í•‘ê³„ë¡œ ì“°ë©´ ëì´ì•¼.",
          "ì§€ê¸ˆì´ í˜ë“  ê±´ ì‚¬ì‹¤. í•˜ì§€ë§Œ ê°€ë§Œíˆ ìˆìœ¼ë©´ ë” í˜ë“¤ì–´ì ¸.",
          "ì§€ê¸ˆ ìƒíƒœëŠ” â€˜ì¶œë°œì„ â€™ì´ì§€ â€˜ë©´ì œê¶Œâ€™ì´ ì•„ë‹ˆì•¼.",
        ];

        // 2) cold fact (í˜„ì‹¤ í•œ ë¬¸ì¥)
        const coldSoft = [
          "ë‹¤ë§Œ, ì˜¤ëŠ˜ë„ ì•„ë¬´ê²ƒë„ ì•ˆ í•˜ë©´ ë‚´ì¼ë„ ë¹„ìŠ·í•´ì§ˆ í™•ë¥ ì´ ë†’ì•„.",
          "ì¡°ê¸ˆë§Œ ì›€ì§ì´ë©´, ê°ì •ì´ ì•„ë‹ˆë¼ â€˜ëª¸â€™ì´ ë¨¼ì € ë”°ë¼ì™€ì¤„ ë•Œê°€ ìˆì–´.",
          "ì™„ë²½ì€ í•„ìš” ì—†ê³ , ì •ì²´ë§Œ í”¼í•˜ì.",
        ];
        const coldBalanced = [
          "ì‰¬ëŠ” ê±´ íšŒë³µì´ì§€ë§Œ, ë©ˆì¶°ìˆìœ¼ë©´ ì •ì²´ì•¼.",
          "ì˜ìš•ì´ ìƒê²¨ì„œ í•˜ëŠ” ê²Œ ì•„ë‹ˆë¼, í•˜ë‹¤ ë³´ë©´ ì˜ìš•ì´ ë¶™ëŠ” ìª½ì´ í˜„ì‹¤ì´ì•¼.",
          "í° ê²°ì‹¬ ì—†ì´ë„ 0ì—ì„œ 1ì€ ë§Œë“¤ ìˆ˜ ìˆì–´.",
        ];
        const coldHard = [
          "ì§€ê¸ˆ ì•„ë¬´ê²ƒë„ ì•ˆ í•˜ë©´, ì´ ìƒíƒœëŠ” ë” êµ³ì–´ì ¸.",
          "ì˜¤ëŠ˜ 3ë¶„ì„ ëª» ë‚´ë©´, ë‚´ì¼ë„ 3ë¶„ì´ ëª» ë‚˜ì™€.",
          "ê°ì •ì€ ì¡´ì¤‘í•˜ë˜, í–‰ë™ì€ ë„¤ê°€ ê²°ì •í•´ì•¼ í•´.",
        ];

        // 3) choice (ì„ íƒê¶Œ)
        const choiceSoft = [
          "ì§€ê¸ˆ ë‹¹ì¥ ì—´ì‹¬íˆ í•˜ë¼ëŠ” ë§ ì•ˆ í• ê²Œ.",
          "ì˜¤ëŠ˜ì€ â€˜ì˜í•¨â€™ ë§ê³  â€˜ì‹œì‘í•¨â€™ë§Œ ëª©í‘œë¡œ í•˜ì.",
          "ì„ íƒê¶Œ ì¤„ê²Œ. ì§€ê¸ˆ ë°”ë¡œ 3ë¶„ë§Œ í• ë˜, ì•„ë‹ˆë©´ 30ì´ˆë§Œ í• ë˜?",
        ];
        const choiceBalanced = [
          "ê°•ìš” ì•ˆ í•´. ëŒ€ì‹  ì„ íƒì€ í•˜ì: â€˜ì•„ì˜ˆ ì•ˆ í•¨â€™ vs â€˜ë”± í•˜ë‚˜ ì‹œì‘â€™.",
          "ì˜¤ëŠ˜ì˜ ëª©í‘œëŠ” ì„±ê³¼ê°€ ì•„ë‹ˆë¼ ì¦ê±°ì•¼. í–ˆë‹¤ëŠ” ì¦ê±°.",
          "ì§€ê¸ˆë¶€í„° 3ë¶„. ëë‚˜ë©´ ê·¸ë§Œí•´ë„ ë¼.",
        ];
        const choiceHard = [
          "í•‘ê³„ëŠ” ì—¬ê¸°ê¹Œì§€. ì„ íƒí•´: 3ë¶„ í•˜ê±°ë‚˜, ì˜¤ëŠ˜ í¬ê¸° ì„ ì–¸í•˜ê³  ë‚´ì¼ ê³„íš ì„¸ì›Œ.",
          "ì˜¤ëŠ˜ì€ ë”± í•˜ë‚˜ë§Œ í•œë‹¤. ê·¸ ì´ìƒì€ ìš•ì‹¬ì´ì•¼.",
          "ì§€ê¸ˆ ì•ˆ í•˜ë©´, ì˜¤ëŠ˜ì€ ê·¸ëƒ¥ í˜ë ¤ë³´ë‚¸ ê±°ì•¼.",
        ];

        // 4) action nudge (ìµœì†Œ í–‰ë™)
        let actionLine = "";
        if (action) {
          const actionTemplates = [
            `ì˜¤ëŠ˜ì˜ í•˜ë‚˜ëŠ” â€œ${action}â€. ì˜ìš•ì€ í•„ìš” ì—†ì–´. ì‹œì‘ë§Œ í•´.`,
            `â€œ${action}â€ë§Œ í•˜ì. ì˜í•˜ëŠ” ê²Œ ì•„ë‹ˆë¼, í•˜ëŠ” ê²Œ ëª©í‘œì•¼.`,
            `ì§€ê¸ˆ ${action}ë¡œ 0â†’1 ë§Œë“¤ì. ë”± 3ë¶„ì´ë©´ ë¼.`,
          ];
          actionLine = pick(actionTemplates);
        } else {
          actionLine =
            "ì˜¤ëŠ˜ì˜ â€˜ë”± í•˜ë‚˜â€™ë¥¼ ê³ ë¥´ì. (ë¬¼/ì•‰ê¸°/ì œëª©ë§Œ/ì§€ìš°ê¸° ì¤‘ ì•„ë¬´ê±°ë‚˜)";
        }

        // blocker-aware micro tweak
        const blockerHintMap = {
          tired: "í”¼ê³¤í•˜ë©´ ë”ë”ìš± â€˜ìƒê°â€™ ë§ê³  â€˜ë™ì‘â€™ìœ¼ë¡œ ê°€ì.",
          anxious: "ë¶ˆì•ˆí• ìˆ˜ë¡ ê³„íšì„ í‚¤ìš°ì§€ ë§ê³ , í–‰ë™ì„ ì¤„ì´ì.",
          overwhelmed: "í•  ì¼ì´ ë§ìœ¼ë©´ â€˜ìš°ì„ ìˆœìœ„â€™ê°€ ì•„ë‹ˆë¼ â€˜ì‚­ì œâ€™ë¶€í„°ì•¼.",
          avoid:
            "ë¯¸ë£¨ê³  ì‹¶ìœ¼ë©´ ëª©í‘œë¥¼ ë‚®ì¶°. 3ë¶„ì´ë©´ ë„ë§ë„ ì•„ë‹ˆê³  ì„±ì·¨ë„ ì•„ë‹ˆì•¼.",
          empty: "ê³µí—ˆí• ìˆ˜ë¡ ê°ì • ë¶„ì„ ë§ê³ , ê°ê°(ë¬¼/ì„¸ìˆ˜/ë°”ê¹¥ ê³µê¸°)ë¶€í„°.",
          pain: "í†µì¦ ìˆìœ¼ë©´ ë¬´ë¦¬ ê¸ˆì§€. ëŒ€ì‹  ê°€ì¥ ê°€ë²¼ìš´ ë™ì‘ìœ¼ë¡œ â€˜ì‹œì‘â€™ë§Œ.",
        };
        const blockerLine = blockers.length
          ? pick(blockers.map((b) => blockerHintMap[b]).filter(Boolean))
          : "ì§€ê¸ˆì€ ë¶„ì„ë³´ë‹¤ â€˜í•œ ë²ˆì˜ ì‹œì‘â€™ì´ ë” íš¨ê³¼ì ì¼ ë•Œê°€ ìˆì–´.";

        const main =
          mode === "ë¶€ë“œëŸ½ê²Œ"
            ? pick(validateSoft)
            : mode === "ê· í˜•"
            ? pick(validateBalanced)
            : pick(validateCold);

        const sub =
          mode === "ë¶€ë“œëŸ½ê²Œ"
            ? pick(coldSoft)
            : mode === "ê· í˜•"
            ? pick(coldBalanced)
            : pick(coldHard);

        const choice =
          mode === "ë¶€ë“œëŸ½ê²Œ"
            ? pick(choiceSoft)
            : mode === "ê· í˜•"
            ? pick(choiceBalanced)
            : pick(choiceHard);

        return { mode, main, sub, choice, actionLine, blockerLine };
      }

      function applyLines(lines) {
        $("#modePill").textContent = `ëª¨ë“œ: ${lines.mode}`;
        $("#mainLine").textContent = lines.main;
        $(
          "#subLine"
        ).textContent = `${lines.sub} ${lines.choice} ${lines.actionLine} ${lines.blockerLine}`;
      }

      // =========================
      // Timer
      // =========================
      function setTimerUI() {
        $("#time").textContent = fmtTime(state.timer.remaining);
        $("#btnPause").textContent = state.timer.running ? "ì¼ì‹œì •ì§€" : "ì¬ê°œ";
      }

      function stopTimer(reset = true) {
        if (state.timer.interval) clearInterval(state.timer.interval);
        state.timer.interval = null;
        state.timer.running = false;
        state.timer.startedAt = null;
        if (reset) state.timer.remaining = 180;
        setTimerUI();
      }

      function startTimer() {
        if (state.timer.running) return;
        state.timer.running = true;
        if (!state.timer.interval) {
          state.timer.interval = setInterval(() => {
            if (!state.timer.running) return;
            state.timer.remaining -= 1;
            if (state.timer.remaining <= 0) {
              state.timer.remaining = 0;
              setTimerUI();
              state.timer.running = false;
              clearInterval(state.timer.interval);
              state.timer.interval = null;
              showToast("3ë¶„ ë. ì—¬ê¸°ì„œ ë©ˆì¶°ë„ ë¼.");
              logEntry("timer_done");
            } else {
              setTimerUI();
            }
          }, 1000);
        }
        setTimerUI();
      }

      function togglePause() {
        state.timer.running = !state.timer.running;
        setTimerUI();
        showToast(state.timer.running ? "ì¬ê°œ" : "ì¼ì‹œì •ì§€");
      }

      // =========================
      // Render
      // =========================
      function renderToday() {
        const d = new Date();
        const y = d.getFullYear();
        const m = d.getMonth() + 1;
        const day = d.getDate();
        $("#todayPill").textContent = `ì˜¤ëŠ˜: ${y}.${String(m).padStart(
          2,
          "0"
        )}.${String(day).padStart(2, "0")}`;
      }

      function renderStreak() {
        $("#streakPill").textContent = `ì—°ì†: ${state.streak}ì¼`;
      }

      function renderLog() {
        const day = todayKey();
        const arr = state.logsByDay[day] || [];
        const box = $("#log");
        box.innerHTML = "";

        if (arr.length === 0) {
          const empty = document.createElement("div");
          empty.className = "hint";
          empty.innerHTML =
            "ì•„ì§ ê¸°ë¡ì´ ì—†ì–´. ê´œì°®ì•„.<br/>ë²„íŠ¼ í•˜ë‚˜ë§Œ ëˆŒëŸ¬ë„ â€˜ì‹œì‘â€™ì´ì•¼.";
          box.appendChild(empty);
          return;
        }

        for (const x of arr) {
          const el = document.createElement("div");
          el.className = "item";
          const tag =
            {
              generate: "ë©˜íŠ¸",
              timer_start: "íƒ€ì´ë¨¸ ì‹œì‘",
              timer_done: "íƒ€ì´ë¨¸ ì™„ë£Œ",
              done: "í–ˆë‹¤(ì²´í¬)",
              skip: "í¬ê¸° ì„ ì–¸",
              memo: "ë©”ëª¨ ì €ì¥",
            }[x.type] || x.type;

          const act = x.action ? ACTION_LABELS[x.action] : "â€”";
          const blockers =
            (x.blockers || []).map((k) => BLOCKER_LABELS[k]).join(", ") || "â€”";

          el.innerHTML = `
          <div class="t">
            <span>${x.time} Â· ${tag}</span>
            <span class="mono">E:${x.energy}/10</span>
          </div>
          <div class="d">í–‰ë™: ${act} Â· ë§‰í˜: ${blockers}${
            x.memo ? " Â· ë©”ëª¨: " + escapeHtml(x.memo) : ""
          }</div>
        `;
          box.appendChild(el);
        }
      }

      function escapeHtml(s) {
        return String(s)
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#039;");
      }

      // =========================
      // UI selection
      // =========================
      function bindChips(containerSel, onPick, selectedSet = false) {
        const chips = $$(containerSel + " .chip");
        chips.forEach((ch) => {
          ch.addEventListener("click", () => {
            if (selectedSet) {
              const key = ch.dataset.key;
              if (state.blockers.has(key)) {
                state.blockers.delete(key);
                ch.classList.remove("selected");
              } else {
                state.blockers.add(key);
                ch.classList.add("selected");
              }
              save();
              return;
            }
            // single select
            chips.forEach((c) => c.classList.remove("selected"));
            ch.classList.add("selected");
            onPick(ch);
            save();
          });
        });
      }

      function restoreSelections() {
        // energy
        $("#energy").value = String(state.energy);
        $("#energyVal").textContent = String(state.energy);
        $("#memo").value = state.memo || "";

        // blockers
        $$("#blockers .chip").forEach((ch) => {
          const k = ch.dataset.key;
          if (state.blockers.has(k)) ch.classList.add("selected");
        });

        // actions
        if (state.action) {
          $$("#actions .chip").forEach((ch) => {
            if (ch.dataset.action === state.action)
              ch.classList.add("selected");
          });
        }
      }

      // =========================
      // Nudge sentences (extra one-liners)
      // =========================
      const NUDGES = [
        "ì˜¤ëŠ˜ì˜ ëª©í‘œëŠ” â€˜ì˜í•¨â€™ì´ ì•„ë‹ˆë¼ â€˜ì‹œì‘í•¨â€™ì´ì•¼.",
        "ì˜ìš•ì´ ì—†ìœ¼ë©´, ëª©í‘œë¥¼ ë‚®ì¶”ëŠ” ê²Œ ì•„ë‹ˆë¼ â€˜ë‹¨ìœ„ë¥¼ ìë¥´ëŠ”â€™ ê±°ì•¼.",
        "3ë¶„ì€ ì¸ìƒì„ ë°”ê¾¸ê¸°ì—” ì‘ê³ , ë¬´ë„ˆì§ì„ ë§‰ê¸°ì—” ì¶©ë¶„íˆ ì»¤.",
        "ì§€ê¸ˆ í•„ìš”í•œ ê±´ í•´ë‹µì´ ì•„ë‹ˆë¼ ì¦ê±°ì•¼. í–ˆë‹¤ëŠ” ì¦ê±°.",
        "ì‰¬ëŠ” ê±´ íšŒë³µ. ê·¸ëŸ°ë° ì˜¤ëŠ˜ì€ 0ì—ì„œ 1ë§Œ ë§Œë“¤ê³  ì‰¬ì.",
        "ì™„ë²½ì£¼ì˜ëŠ” ì˜¤ëŠ˜ ì¶œì… ê¸ˆì§€. ì‹œì‘ë§Œ í—ˆìš©.",
        "ê°ì •ì€ ë‚ ì”¨ê³ , í–‰ë™ì€ ìš°ì‚°ì´ì•¼. ìš°ì‚°ë¶€í„° í´.",
      ];
      function nextNudge() {
        const s = pick(NUDGES);
        $("#mainLine").textContent = s;
        $("#subLine").textContent =
          "ì§€ê¸ˆ ë‹¹ì¥ 3ë¶„ë§Œ. ë©ˆì¶°ë„ ë¼. ì¤‘ìš”í•œ ê±´ â€˜ì‹œì‘â€™ ê¸°ë¡.";
        showToast("ë‹¤ìŒ í•œ ë¬¸ì¥");
        logEntry("generate");
      }

      // =========================
      // í™”ë©´ ì „í™˜
      // =========================
      function showScreen(screenName) {
        $$(".screen").forEach(s => s.classList.remove("active"));
        $(`#${screenName}Screen`).classList.add("active");
        state.currentScreen = screenName;
      }

      // =========================
      // ì„¤ë¬¸ ì§„í–‰
      // =========================
      function startSurvey() {
        state.surveyAnswers = [];
        state.currentQuestionIndex = 0;
        showScreen("survey");
        renderQuestion();
      }

      function renderQuestion() {
        const q = SURVEY_QUESTIONS[state.currentQuestionIndex];
        const progress = ((state.currentQuestionIndex + 1) / SURVEY_QUESTIONS.length) * 100;
        
        $("#questionNumber").textContent = `ì§ˆë¬¸ ${state.currentQuestionIndex + 1}/${SURVEY_QUESTIONS.length}`;
        $("#questionPercent").textContent = `${Math.round(progress)}%`;
        $("#progressFill").style.width = `${progress}%`;
        $("#questionTitle").textContent = q.question;
        
        const optionsContainer = $("#surveyOptions");
        optionsContainer.innerHTML = "";
        
        q.options.forEach((opt, idx) => {
          const div = document.createElement("div");
          div.className = "survey-option";
          div.textContent = opt.text;
          div.dataset.value = opt.value;
          div.dataset.index = idx;
          div.addEventListener("click", () => selectOption(opt, div));
          optionsContainer.appendChild(div);
        });

        $("#btnPrev").style.display = state.currentQuestionIndex === 0 ? "none" : "inline-flex";
        $("#btnNext").disabled = true;
      }

      function selectOption(option, element) {
        $$("#surveyOptions .survey-option").forEach(opt => opt.classList.remove("selected"));
        element.classList.add("selected");
        $("#btnNext").disabled = false;
        
        // ë‹µë³€ ì €ì¥
        if (state.currentQuestionIndex < state.surveyAnswers.length) {
          state.surveyAnswers[state.currentQuestionIndex] = option;
        } else {
          state.surveyAnswers.push(option);
        }
      }

      function nextQuestion() {
        if (state.currentQuestionIndex < SURVEY_QUESTIONS.length - 1) {
          state.currentQuestionIndex++;
          renderQuestion();
        } else {
          showResult();
        }
      }

      function prevQuestion() {
        if (state.currentQuestionIndex > 0) {
          state.currentQuestionIndex--;
          renderQuestion();
          // ì´ì „ ë‹µë³€ ë³µì›
          const prevAnswer = state.surveyAnswers[state.currentQuestionIndex];
          if (prevAnswer) {
            setTimeout(() => {
              $$("#surveyOptions .survey-option").forEach(opt => {
                if (opt.dataset.value === prevAnswer.value) {
                  opt.classList.add("selected");
                  $("#btnNext").disabled = false;
                }
              });
            }, 50);
          }
        }
      }

      function showResult() {
        // ì„¤ë¬¸ ê²°ê³¼ ë¶„ì„
        const firstAnswer = state.surveyAnswers[0];
        const secondAnswer = state.surveyAnswers[1];
        const thirdAnswer = state.surveyAnswers[2];
        const fourthAnswer = state.surveyAnswers[3];
        
        // ì—ë„ˆì§€ ì„¤ì •
        if (secondAnswer && typeof secondAnswer.value === 'number') {
          state.energy = secondAnswer.value;
        } else if (firstAnswer && firstAnswer.energy) {
          state.energy = firstAnswer.energy;
        }
        
        // ë§‰í˜ ì„¤ì •
        if (firstAnswer && firstAnswer.value !== 'ok') {
          state.blockers.add(firstAnswer.value);
        }
        if (thirdAnswer) {
          state.blockers.add(thirdAnswer.value);
        }
        
        // í–‰ë™ ì„¤ì •
        if (fourthAnswer) {
          state.action = fourthAnswer.value;
        }
        
        // ê²°ê³¼ íƒ€ì… ê²°ì •
        let resultType = "ok";
        if (firstAnswer) {
          if (firstAnswer.value === "empty") resultType = "empty";
          else if (firstAnswer.value === "tired") resultType = "tired";
          else if (firstAnswer.value === "anxious") resultType = "anxious";
          else if (firstAnswer.value === "overwhelmed") resultType = "overwhelmed";
          else if (firstAnswer.value === "avoid") resultType = "avoid";
        }
        
        const result = RESULT_TYPES[resultType] || RESULT_TYPES.ok;
        
        $("#resultEmoji").textContent = result.emoji;
        $("#resultTitle").textContent = result.title;
        $("#resultDescription").textContent = result.description;
        
        const actionsContainer = $("#resultActions");
        actionsContainer.innerHTML = "";
        
        result.actions.forEach((act, idx) => {
          const div = document.createElement("div");
          div.className = `result-action ${idx === 0 ? 'primary' : ''}`;
          div.textContent = act.text;
          div.addEventListener("click", () => {
            if (act.action === "timer") {
              showMainScreen();
              setTimeout(() => {
                if (state.action) {
                  $("#btnStart3").click();
                } else {
                  showToast("ë¨¼ì € í–‰ë™ì„ ì„ íƒí•´ì£¼ì„¸ìš”");
                }
              }, 300);
            } else if (act.action === "any") {
              showMainScreen();
            } else {
              state.action = act.action;
              save();
              showMainScreen();
              setTimeout(() => {
                showToast(act.message);
              }, 200);
            }
          });
          actionsContainer.appendChild(div);
        });
        
        // ë©”ì¸ í™”ë©´ìœ¼ë¡œ ê°€ê¸° ë²„íŠ¼ ì¶”ê°€
        const mainBtn = document.createElement("div");
        mainBtn.className = "result-action";
        mainBtn.textContent = "ğŸ“‹ ì „ì²´ ê¸°ëŠ¥ ë³´ê¸°";
        mainBtn.addEventListener("click", showMainScreen);
        actionsContainer.appendChild(mainBtn);
        
        showScreen("result");
        save();
        
        // ê²°ê³¼ í™”ë©´ì— ë„ë‹¬í•œ ê²ƒì„ ì¶•í•˜
        setTimeout(() => {
          showToast("ì„¤ë¬¸ ì™„ë£Œ! ì˜í–ˆì–´! ğŸ‰");
        }, 500);
      }

      function showMainScreen() {
        localStorage.setItem(LS_KEY + "_survey_done", "true");
        showScreen("main");
        restoreSelections();
        const lines = buildLines();
        applyLines(lines);
      }

      // =========================
      // Events
      // =========================
      function init() {
        load();
        
        // ì‹œì‘ í™”ë©´ ë²„íŠ¼
        $("#btnStartSurvey").addEventListener("click", startSurvey);
        
        // ì„¤ë¬¸ ë„¤ë¹„ê²Œì´ì…˜
        $("#btnNext").addEventListener("click", nextQuestion);
        $("#btnPrev").addEventListener("click", prevQuestion);
        
        // ì„¤ë¬¸ í™”ë©´ì—ì„œ í‚¤ë³´ë“œ ì§€ì›
        window.addEventListener("keydown", (e) => {
          if (state.currentScreen !== "survey") return;
          if (e.target && (e.target.tagName === "INPUT" || e.target.tagName === "TEXTAREA")) return;
          
          if (e.key === "Enter" && !$("#btnNext").disabled) {
            nextQuestion();
          } else if (e.key === "ArrowLeft" && state.currentQuestionIndex > 0) {
            prevQuestion();
          } else if (e.key === "ArrowRight" && !$("#btnNext").disabled) {
            nextQuestion();
          } else if (e.key >= "1" && e.key <= "9") {
            const idx = parseInt(e.key) - 1;
            const options = $$("#surveyOptions .survey-option");
            if (options[idx]) {
              options[idx].click();
            }
          }
        });
        
        // ì„¤ë¬¸ ì™„ë£Œ ì—¬ë¶€ í™•ì¸
        const surveyDone = localStorage.getItem(LS_KEY + "_survey_done");
        if (surveyDone === "true") {
          showMainScreen();
        } else {
          showScreen("landing");
        }
        
        renderToday();
        renderStreak();
        restoreSelections();
        renderLog();
        setTimerUI();

        // Energy slider
        $("#energy").addEventListener("input", (e) => {
          state.energy = parseInt(e.target.value, 10);
          $("#energyVal").textContent = String(state.energy);
          save();
        });

        // Memo
        $("#memo").addEventListener("input", (e) => {
          state.memo = e.target.value;
          save();
        });
        $("#memo").addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            e.preventDefault();
            state.memo = $("#memo").value;
            logEntry("memo");
            showToast("ë©”ëª¨ ì €ì¥");
          }
        });

        // Chips
        bindChips("#blockers", () => {}, true);
        bindChips(
          "#actions",
          (ch) => {
            state.action = ch.dataset.action;
          },
          false
        );

        // Generate lines
        $("#btnGenerate").addEventListener("click", () => {
          const lines = buildLines();
          applyLines(lines);
          logEntry("generate");
          showToast("ë©˜íŠ¸ ìƒì„±");
        });

        // Timer
        $("#btnStart3").addEventListener("click", () => {
          if (!state.action) {
            showToast("ë¨¼ì € â€˜ë”± í•˜ë‚˜â€™ë¥¼ ê³ ë¥´ì");
            return;
          }
          // reset and start
          stopTimer(true);
          state.timer.remaining = 180;
          setTimerUI();
          startTimer();
          logEntry("timer_start");
          showToast("3ë¶„ ì‹œì‘");
        });
        $("#btnPause").addEventListener("click", () => {
          if (!state.timer.interval) {
            // if never started, do nothing
            showToast("ë¨¼ì € íƒ€ì´ë¨¸ë¥¼ ì‹œì‘í•´");
            return;
          }
          togglePause();
        });
        $("#btnStop").addEventListener("click", () => {
          stopTimer(true);
          showToast("íƒ€ì´ë¨¸ ì¢…ë£Œ");
        });

        // Done / Skip
        $("#btnDone").addEventListener("click", () => {
          if (!state.action) {
            showToast("ë¨¼ì € â€˜ë”± í•˜ë‚˜â€™ë¥¼ ê³ ë¥´ì");
            return;
          }
          stopTimer(true);
          logEntry("done");
          showToast("ì¢‹ì•„. ì˜¤ëŠ˜ì€ ì—¬ê¸°ê¹Œì§€ë¡œ ì¶©ë¶„í•´.");
        });

        $("#btnSkip").addEventListener("click", () => {
          stopTimer(true);
          logEntry("skip");
          // ëƒ‰ì •í•˜ì§€ë§Œ ë²„ë¦¬ì§€ ì•ŠëŠ” í¬ê¸° ì²˜ë¦¬
          $("#mainLine").textContent = "ì˜¤ëŠ˜ì€ í¬ê¸° ì„ ì–¸, ì˜¤ì¼€ì´.";
          $("#subLine").textContent =
            "ëŒ€ì‹  ì•½ì† í•˜ë‚˜: ë‚´ì¼ì€ â€˜ë”± í•˜ë‚˜â€™ë§Œ ê³ ë¥´ì. (í¬ê²Œ ë§ê³ , ì‘ê²Œ)";
          showToast("í¬ê¸° ì„ ì–¸ ê¸°ë¡");
        });

        // Export / reset / clear
        $("#btnExport").addEventListener("click", async () => {
          const text = exportToday();
          await copyText(text);
        });

        $("#btnClearLog").addEventListener("click", () => {
          const day = todayKey();
          state.logsByDay[day] = [];
          save();
          renderLog();
          showToast("ì˜¤ëŠ˜ ê¸°ë¡ ì‚­ì œ");
        });

        $("#btnReset").addEventListener("click", () => {
          localStorage.removeItem(LS_KEY);
          // soft reload state
          state.energy = 3;
          state.blockers = new Set();
          state.action = null;
          state.memo = "";
          state.logsByDay = {};
          state.streak = 0;
          state.lastDayDone = null;
          stopTimer(true);

          // UI reset
          $$("#blockers .chip, #actions .chip").forEach((c) =>
            c.classList.remove("selected")
          );
          $("#energy").value = "3";
          $("#energyVal").textContent = "3";
          $("#memo").value = "";
          $("#modePill").textContent = "ëª¨ë“œ: ìë™";
          $("#mainLine").textContent = "ì˜¤ëŠ˜ ì˜ìš•ì´ ì—†ì§€? ì´ìƒí•œ ê²Œ ì•„ë‹ˆì•¼.";
          $("#subLine").textContent =
            "ë‹¤ë§Œ, ì§€ê¸ˆ â€œì•„ë¬´ê²ƒë„ ì•ˆ í•˜ë©´â€ ì´ ìƒíƒœëŠ” ì¢‹ì•„ì§€ì§€ ì•Šì•„.";
          renderStreak();
          renderLog();
          showToast("ì´ˆê¸°í™” ì™„ë£Œ");
        });

        $("#btnNudge").addEventListener("click", nextNudge);

        // ì„¤ë¬¸ ë‹¤ì‹œí•˜ê¸°
        $("#btnRestartSurvey").addEventListener("click", () => {
          if (confirm("ì„¤ë¬¸ì„ ë‹¤ì‹œ ì‹œì‘í• ê¹Œìš”? í˜„ì¬ ì§„í–‰ ìƒí™©ì€ ì €ì¥ë©ë‹ˆë‹¤.")) {
            startSurvey();
          }
        });

        // Keyboard shortcuts (ë©”ì¸ í™”ë©´ì—ì„œë§Œ)
        window.addEventListener("keydown", (e) => {
          if (state.currentScreen !== "main") return;
          if (
            e.target &&
            (e.target.tagName === "INPUT" || e.target.tagName === "TEXTAREA")
          )
            return;

          if (e.key === "g" || e.key === "G") $("#btnGenerate").click();
          if (e.key === "t" || e.key === "T") $("#btnStart3").click();
          if (e.key === "d" || e.key === "D") $("#btnDone").click();
          if (e.key === "n" || e.key === "N") $("#btnNudge").click();
        });

        // initial script
        const lines = buildLines();
        applyLines(lines);
      }

      init();
    </script>
  </body>
</html>
